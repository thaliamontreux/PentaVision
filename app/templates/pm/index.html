{% extends 'base.html' %}

{% block title %}Property Manager Â· PentaVision{% endblock %}

{% block content %}
  <section class="pv-section">
    <div class="pv-page-header">
      <div>
        <h1 class="pv-page-title">Property Manager</h1>
        <p class="pv-page-subtitle">Manage properties and their local users.</p>
      </div>
      {% if active_admin_property %}
        <div class="pv-page-actions">
          <form method="post" action="{{ url_for('pm.pm_property_context_clear') }}" class="pv-inline-form">
            <input type="hidden" name="csrf_token" value="{{ global_csrf_token }}" />
            <button type="submit" class="pv-button">Exit Property Context</button>
          </form>
        </div>
      {% endif %}
    </div>

    {% if properties and properties|length %}
      <div class="pv-pm-grid">
        {% for p in properties %}
          <div class="pv-pm-card{% if active_admin_property and active_admin_property.id == p.id %} pv-pm-card-active{% endif %}">
            <div class="pv-pm-card-header">
              <h2 class="pv-pm-card-title">{{ p.name }}</h2>
              {% if active_admin_property and active_admin_property.id == p.id %}
                <span class="pv-pm-badge-active">Active</span>
              {% endif %}
            </div>
            <div class="pv-pm-card-meta">
              {% if p.city or p.state %}
                <span class="pv-pm-meta-item">ğŸ“ {{ p.city or '' }}{% if p.city and p.state %}, {% endif %}{{ p.state or '' }}</span>
              {% endif %}
              {% if p.timezone %}
                <span class="pv-pm-meta-item">ğŸ• {{ p.timezone }}</span>
              {% endif %}
            </div>
            <div class="pv-pm-card-actions">
              <a href="{{ url_for('pm.property_users', property_id=p.id) }}" class="pv-pm-btn pv-pm-btn-primary">
                ğŸ‘¥ Manage Users
              </a>
              {% if is_system_admin or is_property_admin %}
                {% if not (active_admin_property and active_admin_property.id == p.id) %}
                  <form method="post" action="{{ url_for('pm.pm_property_enter', property_id=p.id) }}" class="pv-inline-form">
                    <input type="hidden" name="csrf_token" value="{{ global_csrf_token }}" />
                    <button type="submit" class="pv-pm-btn">Enter Context</button>
                  </form>
                {% endif %}
                <form method="post" action="{{ url_for('pm.pm_property_provision', property_id=p.id) }}" class="pv-inline-form">
                  <input type="hidden" name="csrf_token" value="{{ global_csrf_token }}" />
                  <button type="submit" class="pv-pm-btn pv-pm-btn-subtle">âš™ï¸ Provision DB</button>
                </form>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="pv-empty">
        <p class="pv-empty-title">No properties assigned</p>
        <p class="pv-empty-subtitle">You don't have access to any properties yet. Contact an administrator to be assigned to a property.</p>
      </div>
    {% endif %}
  </section>
{% endblock %}
