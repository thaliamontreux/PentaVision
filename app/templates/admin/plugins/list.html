{% extends 'base.html' %}

{% block title %}Plugins Â· PentaVision{% endblock %}

{% block content %}
<section class="pv-section">
  <div class="pv-admin-layout">
    {% include 'admin/_nav.html' %}
    <div class="pv-admin-main">

      <div class="pv-page-header">
        <div>
          <h1 class="pv-page-title">Enhanced Plugins</h1>
          <p class="pv-page-subtitle">Manage third-party integrations and extensions.</p>
        </div>
        <div class="pv-page-actions">
          <a href="{{ url_for('plugins.admin_plugins_upload') }}" class="pv-btn pv-btn-primary">
            Upload Plugin
          </a>
        </div>
      </div>

      {% if plugin_stats %}
    <div class="plugins-grid">
        {% for stat in plugin_stats %}
        <div class="plugin-card" data-plugin-key="{{ stat.plugin.plugin_key }}">
            <div class="plugin-card-top">
                <div class="plugin-name-row">
                    <div class="plugin-icon-small">
                        {% if stat.plugin.icon_path %}
                        <img src="{{ stat.plugin.icon_path }}" alt="{{ stat.plugin.name }}">
                        {% else %}
                        <div class="plugin-icon-placeholder">{{ stat.plugin.name[0]|upper }}</div>
                        {% endif %}
                    </div>
                    <span class="plugin-name">{{ stat.plugin.name }}</span>
                    <span class="plugin-version">v{{ stat.plugin.version }}</span>
                </div>
                <a href="{{ url_for('plugins.admin_plugin_detail', plugin_key=stat.plugin.plugin_key) }}" class="plugin-config-btn" title="Configure Plugin">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                </a>
            </div>
            <div class="plugin-card-body">
                <div class="plugin-details">
                    <div class="plugin-detail-row">
                        <span class="detail-label">Category:</span>
                        <span class="detail-value">{{ stat.plugin.category|title }}</span>
                    </div>
                    <div class="plugin-detail-row">
                        <span class="detail-label">Properties:</span>
                        <span class="detail-value">{{ stat.property_count }}</span>
                    </div>
                    <div class="plugin-detail-row">
                        <span class="detail-label">Health:</span>
                        <span class="detail-value health-{{ stat.plugin.last_health_status or 'unknown' }}">{{ stat.plugin.last_health_status|default('Unknown')|title }}</span>
                    </div>
                </div>
                <div class="plugin-status-area">
                    <span class="status-badge status-{{ stat.plugin.status }}">
                        {% if stat.plugin.status == 'verified' %}
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"></polyline></svg>
                        {% elif stat.plugin.status == 'enabled' or stat.plugin.status == 'active' %}
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="8"></circle></svg>
                        {% elif stat.plugin.status == 'quarantined' %}
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                        {% elif stat.plugin.status == 'failed' %}
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>
                        {% else %}
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                        {% endif %}
                        {{ stat.plugin.status|replace('_', ' ')|title }}
                    </span>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
      <div class="empty-state">
        <div class="empty-state-icon">ðŸ“¦</div>
        <h2>No Plugins Installed</h2>
        <p>Upload your first plugin to get started with the Enhanced Plugins system.</p>
        <a href="{{ url_for('plugins.admin_plugins_upload') }}" class="pv-btn pv-btn-primary">
          Upload Plugin
        </a>
      </div>
      {% endif %}

    </div>
  </div>
</section>

<style>
.plugins-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 16px;
    margin-top: 20px;
}

.plugin-card {
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    height: 115px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    transition: box-shadow 0.2s, border-color 0.2s;
}

.plugin-card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    border-color: #667eea;
}

.plugin-card-top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 12px 8px 12px;
    border-bottom: 1px solid #f0f0f0;
}

.plugin-name-row {
    display: flex;
    align-items: center;
    gap: 8px;
    flex: 1;
    min-width: 0;
}

.plugin-icon-small {
    width: 24px;
    height: 24px;
    flex-shrink: 0;
}

.plugin-icon-small img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    border-radius: 4px;
}

.plugin-icon-placeholder {
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
    border-radius: 4px;
}

.plugin-name {
    font-size: 14px;
    font-weight: 600;
    color: #222;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.plugin-version {
    font-size: 11px;
    font-family: monospace;
    color: #888;
    flex-shrink: 0;
}

.plugin-config-btn {
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    color: #666;
    transition: background 0.15s, color 0.15s;
    flex-shrink: 0;
}

.plugin-config-btn:hover {
    background: #f0f0f0;
    color: #333;
}

.plugin-card-body {
    flex: 1;
    display: flex;
    padding: 8px 12px 10px 12px;
    gap: 12px;
}

.plugin-details {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 3px;
    min-width: 0;
}

.plugin-detail-row {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
}

.detail-label {
    color: #888;
    flex-shrink: 0;
}

.detail-value {
    color: #444;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.health-healthy, .health-ok { color: #2e7d32; }
.health-unhealthy, .health-failed { color: #c62828; }
.health-degraded { color: #e65100; }
.health-unknown { color: #888; }

.plugin-status-area {
    display: flex;
    align-items: flex-end;
    flex-shrink: 0;
}

.status-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.3px;
}

.status-badge svg {
    flex-shrink: 0;
}

.status-verified {
    background: #e8f5e9;
    color: #2e7d32;
}

.status-enabled, .status-active {
    background: #e3f2fd;
    color: #1565c0;
}

.status-quarantined {
    background: #ffebee;
    color: #c62828;
}

.status-failed {
    background: #ffebee;
    color: #c62828;
}

.status-inactive {
    background: #f5f5f5;
    color: #757575;
}

.status-installed_pending_verification, .status-pending {
    background: #fff3e0;
    color: #e65100;
}

.empty-state {
    text-align: center;
    padding: 60px 20px;
}

.empty-state-icon {
    font-size: 64px;
    margin-bottom: 20px;
}

.empty-state h2 {
    margin: 0 0 12px 0;
    color: #333;
}

.empty-state p {
    margin: 0 0 24px 0;
    color: #666;
}
</style>

{% endblock %}
