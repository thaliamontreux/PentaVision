{% extends 'base.html' %}

{% block title %}Properties · Admin · PentaVision{% endblock %}

{% block content %}
  <section class="pv-section">
    <div class="pv-admin-layout">
      {% include 'admin/_nav.html' %}
      <div class="pv-admin-main">

        <div class="pv-page-header">
          <div>
            <h1 class="pv-page-title">Properties</h1>
            <p class="pv-page-subtitle">Manage locations, time zones, and the active admin workspace.</p>
          </div>
          <div class="pv-page-actions">
            <a href="{{ url_for('admin.property_create') }}" class="pv-button pv-button-primary">
              New property
            </a>
          </div>
        </div>

        {% if errors %}
          <div class="pv-alert pv-alert-error" role="alert">
            <ul>
              {% for error in errors %}
                <li>{{ error }}</li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}

        {% if not properties %}
          <p class="pv-empty-state">No properties have been created yet.</p>
        {% else %}
          <div class="pv-table-wrap">
            <table class="pv-table">
        <thead>
          <tr>
            <th scope="col">ID</th>
            <th scope="col">Name</th>
            <th scope="col">Location</th>
            <th scope="col">Timezone</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for prop in properties %}
            <tr>
              <td>{{ prop.id }}</td>
              <td>{{ prop.name }}</td>
              <td>
                {{ prop.city or '' }}{% if prop.state %}, {{ prop.state }}{% endif %}
              </td>
              <td>{{ prop.timezone or '' }}</td>
              <td>
                <div class="pv-admin-action-group">
                  {% if active_admin_property and active_admin_property.id == prop.id %}
                    <span class="pv-badge">Active</span>
                  {% else %}
                    <form
                      method="post"
                      action="{{ url_for('admin.property_enter', property_id=prop.id) }}"
                      style="display: inline;"
                    >
                      <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
                      <button type="submit" class="pv-button pv-button-small pv-button-primary">
                        Enter
                      </button>
                    </form>
                  {% endif %}
                  <a
                    href="{{ url_for('admin.property_edit', property_id=prop.id) }}"
                    class="pv-button pv-button-small"
                  >
                    Edit
                  </a>
                  <a
                    href="{{ url_for('admin.property_workspace', property_id=prop.id) }}"
                    class="pv-button pv-button-small"
                  >
                    Workspace
                  </a>
                  <form
                    method="post"
                    action="{{ url_for('admin.property_delete', property_id=prop.id) }}"
                    onsubmit="return confirm('Delete this property? This will remove all user links.');"
                  >
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
                    <button type="submit" class="pv-button pv-button-small">
                      Delete
                    </button>
                  </form>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
            </table>
          </div>
        {% endif %}

      </div>
    </div>
  </section>
{% endblock %}
