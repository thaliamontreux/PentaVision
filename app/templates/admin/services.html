{% extends 'base.html' %}

{% block title %}Services Â· PentaVision{% endblock %}

{% block content %}
  <section class="pv-section">
    <div class="pv-admin-layout">
      {% include 'admin/_nav.html' %}
      <div class="pv-admin-main">

        <div class="pv-page-header">
          <div>
            <h1 class="pv-page-title">Services</h1>
            <p class="pv-page-subtitle">Restart allowlisted system services (System Administrators only).</p>
          </div>
        </div>

        {% if errors %}
          <div class="pv-alert pv-alert-error" role="alert">
            <ul>
              {% for error in errors %}
                <li>{{ error }}</li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}

        {% if messages %}
          <div class="pv-alert pv-alert-success" role="status">
            <ul>
              {% for msg in messages %}
                <li>{{ msg }}</li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}

        <div class="pv-card">
          <h2>Systemd services</h2>
          <p class="pv-card-subtitle">Restart allowlisted services. Only System Administrators can access this page.</p>

          <div class="pv-table-wrap pv-mt-3">
            <table class="pv-table">
              <thead>
                <tr>
                  <th>Service</th>
                  <th>Status</th>
                  <th>Enabled</th>
                  <th class="pv-nowrap pv-w-min">Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for s in services %}
                  <tr>
                    <td><code>{{ s.name }}</code></td>
                    <td>{{ s.active_state }}</td>
                    <td>{{ s.enabled_state }}</td>
                    <td>
                      <form method="post" class="pv-inline-form">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
                        <input type="hidden" name="action" value="restart" />
                        <input type="hidden" name="service" value="{{ s.name }}" />
                        <button type="submit" class="pv-button-primary pv-button-small">Restart</button>
                      </form>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>

      </div>
    </div>
  </section>
{% endblock %}
