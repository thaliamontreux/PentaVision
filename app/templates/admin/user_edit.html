{% extends 'base.html' %}

{% block title %}{% if is_edit %}Edit User{% else %}New User{% endif %} · Admin · PentaVision{% endblock %}

{% block content %}
  <section class="pv-section">
    <h1>
      {% if is_edit %}
        Edit user
      {% else %}
        New user
      {% endif %}
    </h1>

    {% include 'admin/_nav.html' %}

    {% if errors %}
      <div class="pv-alert pv-alert-error" role="alert">
        <ul>
          {% for error in errors %}
            <li>{{ error }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    {% if form is not none %}
      <form method="post" class="pv-form" style="max-width: 520px;">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />

        <div class="pv-field-group">
          <label for="email">Email</label>
          <input
            id="email"
            name="email"
            type="email"
            value="{{ form.email }}"
            {% if not is_edit %}required{% else %}readonly{% endif %}
          />
          {% if is_edit %}
            <p class="pv-card-subtitle">Email cannot be changed from this screen.</p>
          {% endif %}
        </div>

        <div class="pv-field-group">
          <label for="full_name">Full name</label>
          <input
            id="full_name"
            name="full_name"
            type="text"
            value="{{ form.full_name }}"
          />
        </div>

        <div class="pv-field-group">
          <label for="preferred_name">Preferred name</label>
          <input
            id="preferred_name"
            name="preferred_name"
            type="text"
            value="{{ form.preferred_name }}"
          />
        </div>

        <div class="pv-field-group">
          <label for="pronouns">Pronouns</label>
          <input
            id="pronouns"
            name="pronouns"
            type="text"
            value="{{ form.pronouns }}"
          />
        </div>

        <div class="pv-field-group">
          <label for="timezone">Time zone</label>
          <input
            id="timezone"
            name="timezone"
            type="text"
            value="{{ form.timezone }}"
          />
          <p class="pv-card-subtitle">
            Optional IANA time zone (for example, <code>America/Chicago</code>).
          </p>
        </div>

        {% if is_edit %}
          <div class="pv-field-group">
            <label for="account_status">Account status</label>
            <input
              id="account_status"
              name="account_status"
              type="text"
              value="{{ form.account_status }}"
            />
            <p class="pv-card-subtitle">
              Optional free-form status such as <code>active</code>, <code>suspended</code>, or <code>disabled</code>.
            </p>
          </div>
        {% else %}
          <div class="pv-field-group">
            <label for="password">Initial password</label>
            <input
              id="password"
              name="password"
              type="password"
              required
            />
          </div>

          <div class="pv-field-group">
            <label for="password_confirm">Confirm password</label>
            <input
              id="password_confirm"
              name="password_confirm"
              type="password"
              required
            />
          </div>

          <fieldset class="pv-field-group">
            <legend>Initial roles</legend>
            <label class="pv-checkbox-label">
              <input
                type="checkbox"
                name="make_admin"
                value="1"
              />
              <span>System Administrator</span>
            </label>
            <label class="pv-checkbox-label" style="margin-top: 0.25rem;">
              <input
                type="checkbox"
                name="make_tech"
                value="1"
              />
              <span>Technician</span>
            </label>
          </fieldset>
        {% endif %}

        <button type="submit" class="pv-button pv-button-primary">
          {% if is_edit %}
            Save changes
          {% else %}
            Create user
          {% endif %}
        </button>
        <a href="{{ url_for('admin.users_list') }}" class="pv-button" style="margin-left: 0.5rem;">
          Cancel
        </a>
      </form>
    {% else %}
      <p>Nothing to edit.</p>
    {% endif %}
  </section>
{% endblock %}
