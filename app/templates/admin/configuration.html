{% extends 'base.html' %}

{% block title %}Configuration · Admin · PentaVision{% endblock %}

{% block content %}
  <section class="pv-section">
    <div class="pv-admin-layout">
      {% include 'admin/_nav.html' %}
      <div class="pv-admin-main">

        <div class="pv-page-header">
          <div>
            <h1 class="pv-page-title">Configuration</h1>
            <p class="pv-page-subtitle">Manage application configuration stored in the database. The effective value is shown for each key.</p>
          </div>
        </div>

        {% if errors %}
          <div class="pv-alert pv-alert-error" role="alert">
            <ul>
              {% for error in errors %}
                <li>{{ error }}</li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}

        {% if messages %}
          <div class="pv-alert pv-alert-success" role="status">
            <ul>
              {% for msg in messages %}
                <li>{{ msg }}</li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}

        <div class="pv-card">
          <h2>Settings</h2>
          <p class="pv-card-subtitle">Enable a DB override per key to persist it. Protected bootstrap keys are read-only.</p>

          <form method="post" class="pv-form" style="margin-top: 0;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />

            <div class="pv-table-wrap pv-mt-3">
              <table class="pv-table">
                <thead>
                  <tr>
                    <th>Key</th>
                    <th class="pv-nowrap">DB override</th>
                    <th>Value</th>
                    <th>Effective</th>
                  </tr>
                </thead>
                <tbody>
                  {% for r in rows %}
                    <tr>
                      <td class="pv-nowrap"><code>{{ r.key }}</code></td>
                      <td class="pv-nowrap">
                        {% if r.protected %}
                          <span style="color:#9ca3af;">Protected</span>
                        {% else %}
                          <label class="pv-inline-form" style="gap: 0.45rem; align-items:center;">
                            <input type="checkbox" name="override__{{ r.key }}" value="1" {% if r.override_enabled %}checked{% endif %} />
                            <span>Use DB</span>
                          </label>
                        {% endif %}
                      </td>
                      <td>
                        {% if r.protected %}
                          <input name="value__{{ r.key }}" value="{{ r.value }}" disabled />
                        {% else %}
                          {% if r.options and r.options|length %}
                            <select name="value__{{ r.key }}">
                              {% for opt in r.options %}
                                <option value="{{ opt }}" {% if opt|string == r.value|string %}selected{% endif %}>{{ opt }}</option>
                              {% endfor %}
                            </select>
                          {% else %}
                            <input name="value__{{ r.key }}" value="{{ r.value }}" />
                          {% endif %}
                        {% endif %}
                      </td>
                      <td><code>{{ r.effective }}</code></td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>

            <div class="pv-form-actions">
              <button type="submit" class="pv-button-primary">Save configuration</button>
            </div>
          </form>
        </div>

      </div>
    </div>
  </section>
{% endblock %}
