{% extends 'base.html' %}

{% block title %}{% if is_edit %}Edit RTMP Output{% else %}New RTMP Output{% endif %} Â· PentaVision{% endblock %}

{% block content %}
  <section class="pv-section">
    <div class="pv-admin-layout">
      {% include 'admin/_nav.html' %}
      <div class="pv-admin-main">
        <div class="pv-page-header">
          <div>
            <h1 class="pv-page-title">
              {% if is_edit %}
                Edit RTMP Output
              {% else %}
                New RTMP Output
              {% endif %}
            </h1>
          </div>
          <div class="pv-page-actions">
            <a href="{{ url_for('camera_admin.rtmp_list') }}" class="pv-button-secondary">Back</a>
          </div>
        </div>

    {% if errors %}
      <div class="pv-alert pv-alert-error">
        <ul>
          {% for error in errors %}
            <li>{{ error }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

        <form method="post" class="pv-form">
          <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />

      <div class="pv-field-group">
        <label for="device_id">Camera</label>
        <select id="device_id" name="device_id" required>
          <option value="">(select a camera)</option>
          {% for d in devices %}
            <option
              value="{{ d.id }}"
              {% if form.device_id == d.id|string %}selected{% endif %}
            >
              {{ d.name }} ({{ d.ip_address }})
            </option>
          {% endfor %}
        </select>
        <p class="pv-card-subtitle">
          Select which camera feed this RTMP output should restream.
        </p>
      </div>

      <div class="pv-field-group">
        <label for="target_url">RTMP output URL</label>
        <input
          id="target_url"
          name="target_url"
          type="text"
          required
          value="{{ form.target_url }}"
        />
        <p class="pv-card-subtitle">
          Example: <code>rtmp://server/app/streamkey</code> or
          <code>rtmps://server/app/streamkey</code>.
        </p>
      </div>

      <div class="pv-field-group">
        <label>
          <input
            type="checkbox"
            name="is_active"
            value="1"
            {% if form.is_active %}checked{% endif %}
          />
          Enable this RTMP output
        </label>
        <p class="pv-card-subtitle">
          When enabled, the RTMP worker service will restream this camera to the
          configured RTMP output URL.
        </p>
      </div>

          <button type="submit" class="pv-button-primary">
            {% if is_edit %}
              Save changes
            {% else %}
              Create RTMP output
            {% endif %}
          </button>
          <a href="{{ url_for('camera_admin.rtmp_list') }}" class="pv-button-secondary pv-ml-2">
            Cancel
          </a>
        </form>
      </div>
    </div>
  </section>
{% endblock %}
